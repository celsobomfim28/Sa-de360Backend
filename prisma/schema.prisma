generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "windows", "debian-openssl-3.0.x"]
  engineType    = "library"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model appointments {
  id                                            String            @id
  patientId                                     String
  professionalId                                String?
  scheduledDate                                 DateTime
  type                                          AppointmentType
  reason                                        String?
  status                                        AppointmentStatus @default(SCHEDULED)
  observations                                  String?
  checkedInAt                                   DateTime?
  absenceReason                                 String?
  absenceReportedById                           String?
  absenceReportedAt                             DateTime?
  noticeGiven                                   Boolean           @default(false)
  noticeGivenAt                                 DateTime?
  noticeGivenById                               String?
  createdAt                                     DateTime          @default(now())
  updatedAt                                     DateTime
  users_appointments_absenceReportedByIdTousers users?            @relation("appointments_absenceReportedByIdTousers", fields: [absenceReportedById], references: [id])
  users_appointments_noticeGivenByIdTousers     users?            @relation("appointments_noticeGivenByIdTousers", fields: [noticeGivenById], references: [id])
  patients                                      patients          @relation(fields: [patientId], references: [id])
  users_appointments_professionalIdTousers      users?            @relation("appointments_professionalIdTousers", fields: [professionalId], references: [id])
}

model audit_logs {
  id         String   @id
  userId     String
  action     String
  entityType String
  entityId   String
  oldData    Json?
  newData    Json?
  ipAddress  String?
  userAgent  String?
  createdAt  DateTime @default(now())
  users      users    @relation(fields: [userId], references: [id])
}

model childcare_consultations {
  id                    String      @id
  patientId             String
  professionalId        String
  consultationDate      DateTime
  weight                Float
  height                Float
  headCircumference     Float?
  developmentMilestones Json
  feedingType           FeedingType
  feedingObservations   String?
  observations          String?
  createdAt             DateTime    @default(now())
  updatedAt             DateTime
  patients              patients    @relation(fields: [patientId], references: [id])
  users                 users       @relation(fields: [professionalId], references: [id])
}

model childcare_indicators {
  id                    String          @id
  patientId             String          @unique
  firstConsultationDate DateTime?
  b1Status              IndicatorStatus
  consultationCount     Int             @default(0)
  b2Status              IndicatorStatus
  anthropometryCount    Int             @default(0)
  b3Status              IndicatorStatus
  vd1Date               DateTime?
  vd2Date               DateTime?
  b4Status              IndicatorStatus
  vaccineStatus         VaccineStatus
  b5Status              IndicatorStatus
  lastUpdated           DateTime
  patients              patients        @relation(fields: [patientId], references: [id])
}

model diabetes_consultations {
  id                  String       @id
  patientId           String
  professionalId      String
  consultationDate    DateTime
  glucose             Float?
  glucoseType         GlucoseType?
  hba1c               Float?
  footExamPerformed   Boolean      @default(false)
  footExamResult      String?
  weight              Float?
  height              Float?
  imc                 Float?
  medicationAdherence Boolean      @default(true)
  observations        String?
  createdAt           DateTime     @default(now())
  updatedAt           DateTime
  patients            patients     @relation(fields: [patientId], references: [id])
  users               users        @relation(fields: [professionalId], references: [id])
}

model diabetes_indicators {
  id                     String          @id
  patientId              String          @unique
  lastConsultationDate   DateTime?
  d1Status               IndicatorStatus
  lastBloodPressureDate  DateTime?
  d2Status               IndicatorStatus
  lastAnthropometryDate  DateTime?
  d3Status               IndicatorStatus
  visitCountLast12Months Int             @default(0)
  d4Status               IndicatorStatus
  lastHba1cDate          DateTime?
  d5Status               IndicatorStatus
  lastFootExamDate       DateTime?
  d6Status               IndicatorStatus
  lastUpdated            DateTime
  patients               patients        @relation(fields: [patientId], references: [id])
}

model elderly_consultations {
  id               String   @id
  patientId        String
  professionalId   String
  consultationDate DateTime
  ivcfScore        Int?
  isVulnerable     Boolean  @default(false)
  medicationsCount Int      @default(0)
  medicationsList  String?
  observations     String?
  createdAt        DateTime @default(now())
  updatedAt        DateTime
  patients         patients @relation(fields: [patientId], references: [id])
  users            users    @relation(fields: [professionalId], references: [id])
}

model elderly_indicators {
  id                       String          @id
  patientId                String          @unique
  lastConsultationDate     DateTime?
  aStatus                  IndicatorStatus @default(RED)
  lastAnthropometryDate    DateTime?
  bStatus                  IndicatorStatus @default(RED)
  hasPolypharmacy          Boolean         @default(false)
  polypharmacyUpdatedDate  DateTime?
  f1Status                 IndicatorStatus
  lastIvcfDate             DateTime?
  ivcfScore                Int?
  f2Status                 IndicatorStatus
  visitCountLast12Months   Int             @default(0)
  c3Status                 IndicatorStatus @default(RED)
  lastInfluenzaVaccineDate DateTime?
  dStatus                  IndicatorStatus @default(RED)
  lastUpdated              DateTime
  patients                 patients        @relation(fields: [patientId], references: [id])
}

model home_visits {
  id           String        @id
  patientId    String
  acsId        String
  visitDate    DateTime
  visitType    HomeVisitType
  purpose      String
  observations String?
  latitude     Float?
  longitude    Float?
  createdAt    DateTime      @default(now())
  updatedAt    DateTime
  users        users         @relation(fields: [acsId], references: [id])
  patients     patients      @relation(fields: [patientId], references: [id])
}

model hypertension_consultations {
  id                  String   @id
  patientId           String
  professionalId      String
  consultationDate    DateTime
  systolicBP          Int
  diastolicBP         Int
  heartRate           Int?
  weight              Float?
  height              Float?
  imc                 Float?
  medicationAdherence Boolean  @default(true)
  observations        String?
  createdAt           DateTime @default(now())
  updatedAt           DateTime
  patients            patients @relation(fields: [patientId], references: [id])
  users               users    @relation(fields: [professionalId], references: [id])
}

model hypertension_indicators {
  id                     String          @id
  patientId              String          @unique
  lastConsultationDate   DateTime?
  e1Status               IndicatorStatus
  lastBloodPressureDate  DateTime?
  e2Status               IndicatorStatus
  lastAnthropometryDate  DateTime?
  e3Status               IndicatorStatus
  visitCountLast12Months Int             @default(0)
  e4Status               IndicatorStatus
  lastUpdated            DateTime
  patients               patients        @relation(fields: [patientId], references: [id])
}

model micro_areas {
  id          String     @id
  name        String
  code        String     @unique
  description String?
  createdAt   DateTime   @default(now())
  updatedAt   DateTime
  patients    patients[]
  users       users[]
}

model patients {
  id                         String                       @id
  cpf                        String?                      @unique
  cns                        String                       @unique
  fullName                   String
  birthDate                  DateTime
  sex                        Sex
  motherName                 String
  street                     String
  number                     String
  complement                 String?
  neighborhood               String
  zipCode                    String
  referencePoint             String?
  latitude                   Float?
  longitude                  Float?
  geocodedAt                 DateTime?
  microAreaId                String
  primaryPhone               String
  secondaryPhone             String?
  email                      String?
  isChild                    Boolean                      @default(false)
  isPregnant                 Boolean                      @default(false)
  isPostpartum               Boolean                      @default(false)
  hasHypertension            Boolean                      @default(false)
  hypertensionDiagnosisDate  DateTime?
  hasDiabetes                Boolean                      @default(false)
  diabetesDiagnosisDate      DateTime?
  isElderly                  Boolean                      @default(false)
  isWoman                    Boolean                      @default(false)
  createdAt                  DateTime                     @default(now())
  updatedAt                  DateTime
  deletedAt                  DateTime?
  createdById                String
  appointments               appointments[]
  childcare_consultations    childcare_consultations[]
  childcare_indicators       childcare_indicators?
  diabetes_consultations     diabetes_consultations[]
  diabetes_indicators        diabetes_indicators?
  elderly_consultations      elderly_consultations[]
  elderly_indicators         elderly_indicators?
  home_visits                home_visits[]
  hypertension_consultations hypertension_consultations[]
  hypertension_indicators    hypertension_indicators?
  lab_exam_requests          lab_exam_requests[]
  users                      users                        @relation(fields: [createdById], references: [id])
  micro_areas                micro_areas                  @relation(fields: [microAreaId], references: [id])
  postpartum_consultations   postpartum_consultations[]
  prenatal_data              prenatal_data?
  vaccine_records            vaccine_records[]
  woman_exams                woman_exams[]
  woman_health_indicators    woman_health_indicators?
  anthropometry              anthropometry[]
  blood_pressure             blood_pressure[]
  glucose_measurement        glucose_measurement[]
}

model postpartum_consultations {
  id                  String              @id
  patientId           String
  professionalId      String
  consultationDate    DateTime
  deliveryDate        DateTime
  deliveryType        DeliveryType
  weight              Float
  bloodPressure       String
  uterineInvolution   InvolutionStatus
  lochia              LochiaStatus
  breastfeeding       BreastfeedingStatus
  contraceptiveMethod String?
  observations        String?
  createdAt           DateTime            @default(now())
  updatedAt           DateTime
  patients            patients            @relation(fields: [patientId], references: [id])
  users               users               @relation(fields: [professionalId], references: [id])
}

model prenatal_consultations {
  id               String        @id
  prenatalDataId   String
  professionalId   String
  consultationDate DateTime
  gestationalAge   Int
  weight           Float
  height           Float?
  bloodPressure    String
  uterineHeight    Float?
  fetalHeartRate   Int?
  edema            Boolean       @default(false)
  complaints       String?
  conduct          String?
  observations     String?
  createdAt        DateTime      @default(now())
  updatedAt        DateTime
  prenatal_data    prenatal_data @relation(fields: [prenatalDataId], references: [id])
  users            users         @relation(fields: [professionalId], references: [id])
}

model prenatal_data {
  id                     String                   @id
  patientId              String                   @unique
  lastMenstrualDate      DateTime
  expectedDeliveryDate   DateTime
  gestationalAge         Int
  isHighRisk             Boolean                  @default(false)
  previousPregnancies    Int
  previousDeliveries     Int
  previousAbortions      Int
  deliveryDate           DateTime?
  deliveryType           DeliveryType?
  createdAt              DateTime                 @default(now())
  updatedAt              DateTime
  prenatal_consultations prenatal_consultations[]
  patients               patients                 @relation(fields: [patientId], references: [id])
  prenatal_exams         prenatal_exams[]
  prenatal_indicators    prenatal_indicators?
}

model prenatal_exams {
  id             String           @id
  prenatalDataId String
  examType       PrenatalExamType
  requestDate    DateTime
  resultDate     DateTime?
  result         String?
  evaluated      Boolean          @default(false)
  evaluatedById  String?
  evaluatedAt    DateTime?
  createdAt      DateTime         @default(now())
  updatedAt      DateTime
  users          users?           @relation(fields: [evaluatedById], references: [id])
  prenatal_data  prenatal_data    @relation(fields: [prenatalDataId], references: [id])
}

model prenatal_indicators {
  id                         String          @id
  prenatalDataId             String          @unique
  prenatalConsultationCount  Int             @default(0)
  postpartumConsultationDone Boolean         @default(false)
  c1Status                   IndicatorStatus
  bloodPressureCount         Int             @default(0)
  c2Status                   IndicatorStatus
  weightHeightRecorded       Boolean         @default(false)
  c3Status                   IndicatorStatus
  vd1Date                    DateTime?
  vd2Date                    DateTime?
  vd3Date                    DateTime?
  vdPostpartumDate           DateTime?
  c4Status                   IndicatorStatus
  dtpaVaccineDate            DateTime?
  c5Status                   IndicatorStatus
  exams1stTriCompleted       Boolean         @default(false)
  exams3rdTriCompleted       Boolean         @default(false)
  c6Status                   IndicatorStatus
  lastUpdated                DateTime
  prenatal_data              prenatal_data   @relation(fields: [prenatalDataId], references: [id])
}

model users {
  id                                                   String                       @id
  cpf                                                  String                       @unique
  fullName                                             String
  email                                                String?                      @unique
  password                                             String
  role                                                 UserRole
  isActive                                             Boolean                      @default(true)
  microAreaId                                          String?
  createdAt                                            DateTime                     @default(now())
  updatedAt                                            DateTime
  deletedAt                                            DateTime?
  appointments_appointments_absenceReportedByIdTousers appointments[]               @relation("appointments_absenceReportedByIdTousers")
  appointments_appointments_noticeGivenByIdTousers     appointments[]               @relation("appointments_noticeGivenByIdTousers")
  appointments_appointments_professionalIdTousers      appointments[]               @relation("appointments_professionalIdTousers")
  audit_logs                                           audit_logs[]
  childcare_consultations                              childcare_consultations[]
  diabetes_consultations                               diabetes_consultations[]
  elderly_consultations                                elderly_consultations[]
  home_visits                                          home_visits[]
  hypertension_consultations                           hypertension_consultations[]
  lab_exam_requests_requested                          lab_exam_requests[]          @relation("lab_exam_requested_by")
  lab_exams_evaluated                                  lab_exams[]                  @relation("lab_exam_evaluated_by")
  notifications                                        notifications[]
  patients                                             patients[]
  postpartum_consultations                             postpartum_consultations[]
  prenatal_consultations                               prenatal_consultations[]
  prenatal_exams                                       prenatal_exams[]
  micro_areas                                          micro_areas?                 @relation(fields: [microAreaId], references: [id])
  vaccine_records                                      vaccine_records[]
  woman_exams                                          woman_exams[]
  anthropometry                                        anthropometry[]
  blood_pressure                                       blood_pressure[]
  glucose_measurement                                  glucose_measurement[]
}

model vaccine_records {
  id              String   @id
  patientId       String
  vaccineId       String
  applicationDate DateTime
  dose            Int
  batchNumber     String?
  appliedById     String
  createdAt       DateTime @default(now())
  updatedAt       DateTime
  users           users    @relation(fields: [appliedById], references: [id])
  patients        patients @relation(fields: [patientId], references: [id])
  vaccines        vaccines @relation(fields: [vaccineId], references: [id])
}

model vaccines {
  id              String            @id
  name            String            @unique
  description     String?
  ageSchedule     Json
  createdAt       DateTime          @default(now())
  updatedAt       DateTime
  vaccine_records vaccine_records[]
}

model woman_exams {
  id            String        @id
  patientId     String
  type          WomanExamType
  examDate      DateTime
  result        String?
  observations  String?
  performedById String?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime
  patients      patients      @relation(fields: [patientId], references: [id])
  users         users?        @relation(fields: [performedById], references: [id])
}

model woman_health_indicators {
  id                              String          @id
  patientId                       String          @unique
  lastPapSmearDate                DateTime?
  g1Status                        IndicatorStatus
  lastMammographyDate             DateTime?
  g2Status                        IndicatorStatus
  lastSexualHealthConsultationDate DateTime?
  cStatus                         IndicatorStatus @default(RED)
  lastHpvVaccineDate              DateTime?
  bStatus                         IndicatorStatus @default(RED)
  lastUpdated                     DateTime
  patients                        patients        @relation(fields: [patientId], references: [id])
}

model lab_exam_requests {
  id           String            @id @default(uuid())
  patientId    String
  requestedById String
  requestDate  DateTime          @default(now())
  priority     ExamPriority      @default(ROUTINE)
  clinicalInfo String?
  status       ExamRequestStatus @default(PENDING)
  createdAt    DateTime          @default(now())
  updatedAt    DateTime          @updatedAt
  patient      patients          @relation(fields: [patientId], references: [id])
  requestedBy  users             @relation("lab_exam_requested_by", fields: [requestedById], references: [id])
  exams        lab_exams[]

  @@index([patientId, requestDate])
  @@index([status])
}

model lab_exams {
  id             String             @id @default(uuid())
  requestId      String
  examType       LabExamType
  collectionDate DateTime?
  collectedBy    String?
  resultDate     DateTime?
  result         Json?
  resultText     String?
  referenceRange String?
  interpretation ExamInterpretation?
  evaluated      Boolean            @default(false)
  evaluatedById  String?
  evaluatedAt    DateTime?
  observations   String?
  createdAt      DateTime           @default(now())
  updatedAt      DateTime           @updatedAt
  request        lab_exam_requests  @relation(fields: [requestId], references: [id], onDelete: Cascade)
  evaluatedBy    users?             @relation("lab_exam_evaluated_by", fields: [evaluatedById], references: [id])

  @@index([requestId])
  @@index([examType])
  @@index([evaluated, resultDate])
}

enum AppointmentStatus {
  SCHEDULED
  CONFIRMED
  COMPLETED
  ABSENT
  CANCELLED
  RESCHEDULED
}

enum AppointmentType {
  PRENATAL
  CHILDCARE
  HYPERTENSION
  DIABETES
  ROUTINE
  POSTPARTUM
  ELDERLY_CARE
  WOMAN_HEALTH
  MEDICAL
  NURSING
  DENTAL
  OTHER
}

enum BreastfeedingStatus {
  YES
  NO
  WITH_DIFFICULTIES
}

enum DeliveryType {
  VAGINAL
  CESAREAN
}

enum FeedingType {
  EXCLUSIVE_BREASTFEEDING
  COMPLEMENTARY_FEEDING
  ARTIFICIAL_FEEDING
  MIXED_FEEDING
}

enum GlucoseType {
  FASTING
  POSTPRANDIAL
  CASUAL
}

enum HomeVisitType {
  NEWBORN_VD1
  NEWBORN_VD2
  PREGNANT_VD1
  PREGNANT_VD2
  PREGNANT_VD3
  POSTPARTUM_VD
  ACTIVE_SEARCH
  ROUTINE
}

enum IndicatorStatus {
  GREEN
  YELLOW
  RED
}

enum InvolutionStatus {
  ADEQUATE
  INADEQUATE
}

enum LochiaStatus {
  NORMAL
  ALTERED
}

enum PrenatalExamType {
  SYPHILIS_1ST_TRI
  HIV_1ST_TRI
  HEPATITIS_B_1ST_TRI
  HEPATITIS_C_1ST_TRI
  SYPHILIS_3RD_TRI
  HIV_3RD_TRI
}

enum Sex {
  MALE
  FEMALE
  OTHER
}

enum UserRole {
  ACS
  TECNICO_ENFERMAGEM
  ENFERMEIRO
  MEDICO
  ADMIN
}

enum VaccineStatus {
  UP_TO_DATE
  DELAYED
  NOT_STARTED
}

enum WomanExamType {
  PAP_SMEAR
  MAMMOGRAPHY
}

model notifications {
  id        String           @id @default(uuid())
  userId    String
  type      NotificationType
  title     String
  message   String
  data      Json?
  read      Boolean          @default(false)
  readAt    DateTime?
  createdAt DateTime         @default(now())
  users     users            @relation(fields: [userId], references: [id])

  @@index([userId, read])
  @@index([createdAt])
}

enum NotificationType {
  APPOINTMENT_REMINDER
  APPOINTMENT_CONFIRMED
  APPOINTMENT_CANCELLED
  EXAM_RESULT_READY
  EXAM_PENDING_EVALUATION
  VACCINE_DUE
  VACCINE_OVERDUE
  INDICATOR_CRITICAL
  HOME_VISIT_SCHEDULED
  PATIENT_PRIORITY
}

enum ExamPriority {
  ROUTINE
  URGENT
  EMERGENCY
}

enum ExamRequestStatus {
  PENDING
  COLLECTED
  IN_ANALYSIS
  COMPLETED
  CANCELLED
}

enum ExamInterpretation {
  NORMAL
  ALTERED
  CRITICAL
}

enum LabExamType {
  HEMOGRAM
  HEMOGLOBIN
  HEMATOCRIT
  PLATELETS
  LEUKOCYTES
  GLUCOSE
  HBA1C
  TOTAL_CHOLESTEROL
  HDL_CHOLESTEROL
  LDL_CHOLESTEROL
  TRIGLYCERIDES
  UREA
  CREATININE
  URIC_ACID
  TGO_AST
  TGP_ALT
  BILIRUBIN
  ALKALINE_PHOSPHATASE
  TSH
  T4_FREE
  SYPHILIS_VDRL
  HIV
  HEPATITIS_B
  HEPATITIS_C
  TOXOPLASMOSIS
  RUBELLA
  URINALYSIS
  URINE_CULTURE
  STOOL_EXAM
  STOOL_CULTURE
  PSA
  PREGNANCY_TEST
  COVID_19
  OTHER
}

model anthropometry {
  id              String   @id
  patientId       String
  professionalId  String
  measurementDate DateTime
  weight          Float?
  height          Float?
  imc             Float?
  createdAt       DateTime @default(now())
  updatedAt       DateTime
  patients        patients @relation(fields: [patientId], references: [id])
  users           users    @relation(fields: [professionalId], references: [id])

  @@index([patientId, measurementDate])
}

model blood_pressure {
  id              String   @id
  patientId       String
  professionalId  String
  measurementDate DateTime
  systolicBP      Int
  diastolicBP     Int
  createdAt       DateTime @default(now())
  updatedAt       DateTime
  patients        patients @relation(fields: [patientId], references: [id])
  users           users    @relation(fields: [professionalId], references: [id])

  @@index([patientId, measurementDate])
}

model glucose_measurement {
  id              String   @id
  patientId       String
  professionalId  String
  measurementDate DateTime
  glucose         Float
  glucoseType     GlucoseType?
  createdAt       DateTime @default(now())
  updatedAt       DateTime
  patients        patients @relation(fields: [patientId], references: [id])
  users           users    @relation(fields: [professionalId], references: [id])

  @@index([patientId, measurementDate])
}
